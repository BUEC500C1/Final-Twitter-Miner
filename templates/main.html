<!doctype html>
<html>
<head>

<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
	<style>
		body {background-color: black;}
		h1{
			font-family: Georgia, serif;
			font-weight: bold;
			font-stretch: extra-expanded;
			text-align: center;
			color: white;
		}
		form{
  			margin: auto;
  			position: relative;
  			font-family:  "Courier New", Courier, monospace;
  			font-size: 20px;
  			line-height: 24px;
  			font-weight: bold;
  			color: white;
  			text-align: center;
		}
    input[type=submit] {
        background-color: #15B097;
        border: none;
        color: white;
        font-size:20px;
        padding: 8px 20px;
        text-decoration: none;
        margin: 4px 2px;
        cursor: pointer;
    }
   
    #map {
    width: 100%;
    height: 400px;
    background-color: grey;
    }

		
	</style>

  <title>Search Term Opinions</title>
    
</head>
<body>
<form method="POST" action ="">
  <p>Twitter opinions on the following search term:
  <input type="text" id="searchTerm" name="searchTerm"> 
&nbsp;&nbsp;&nbsp;&nbsp;  
<font color="blue">Positive</font> 
<font color="yellow">Neutral</font> 

<font color="red">Negative</font> </p>



  <p> for the past ...
  <input type="radio" id="day" name="time" value="day" checked>
  <label for="day">day</label><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <input type="radio" id="month" name="time" value="month">
  <label for="month">30 days</label><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <input type="radio" id="year" name="time" value="year">
  <label for="year">year</label> </p>
  <input type="submit" name="action" value="Search">
  <input type="submit" value="Export" name="action" style="visibility:hidden;" id= "save">


</form>


<script>
  if ({{butOn}} == 1){
    var save = document.getElementById("save");
    save.style.visibility = "visible";
  }


</script>


<div id="map"></div>
    <script>
     
      
      var pydata = {{ loc_cords | tojson }};
      var feeling = {{sent_list}};

      console.log(pydata)
      console.log(pydata.length)
      console.log(feeling);
      locations = [];
      latTrue =1
      var lat = 0.0
      for (i = 0; i < pydata.length; i+= 2) {
        locations.push({
          lat: parseFloat(pydata[i]),
          lng: parseFloat(pydata[i + 1])
        });
    
      }

      console.log(JSON.stringify(locations))
      function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: {lat: 28.024, lng: 140.887}
        });

        var markers = locations.map(function(location, i) {
          return new google.maps.Marker({
            position: location,
        
          });
        });

        
        var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: '/static/markers/m',
            calculator: function(markers, numStyles) {
              index = 1;
              var red = 0;
              var blue = 0;
              var yellow = 0;
              for (var i = 0; i < markers.length; i++) {
                if (feeling[i] == 1) {
                  blue++;
             
                } else if (feeling[i] == 2) {
                  yellow++;
                } else{
                  red++;
                 
                }
              }
              max = Math.max(blue, yellow, red);

              if (max == blue) index = 1;
              if (max == yellow) index = 2;
              if (max == red) index = 3;
              if (red == blue) index = 2;
              return {text:markers.length, index:index};
            }
          });
      }
    </script> 

</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA837v4bjEdBUTFb8_a6amj8AGH8RdnJMw&callback=initMap">
</script>

<script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>

</body>
</html>
